

В проекте Istio istio/cni/pkg/ebpf/server/ambient_redirect_bpf.goроль файла заключается в реализации серверного кода eBPF (расширенный фильтр пакетов Berkeley) для обработки функции перенаправления среды.

`_Ambient_redirectBytes` Является переменной, используемой для хранения байт-кода программы eBPF.Он содержит последовательность команд программы eBPF, которая используется для выполнения сетевых перенаправлений в ядре.

`ambient_redirectAppInfo` Структура используется для хранения информации о приложении, такой как идентификаторы и правила перенаправления.

`ambient_redirectHostInfo` Структура используется для хранения информации о хосте, такой как идентификатор хоста и правила перенаправления.

`ambient_redirectZtunnelInfo` Структура используется для хранения информации, связанной с Ztunnel (сетевой туннель с нулевым копированием), такой как идентификаторы и правила перенаправления.

`ambient_redirectSpecs` Структура определяет спецификацию ряда правил перенаправления, включая правила приложения, хоста и Ztunnel.

`ambient_redirectProgramSpecs` Структура определяет спецификацию программы eBPF, включая тип, инструкцию и отображение программы.

ambient_redirectMapSpecsСтруктура определяет спецификацию сопоставления eBPF, включая имя, тип и размер пары ключ-значение сопоставления.

ambient_redirectObjectsСтруктура используется для хранения загруженных объектов eBPF, включая программы и сопоставления.

ambient_redirectMapsСтруктура определяет экземпляр загруженной карты eBPF.

ambient_redirectProgramsСтруктура определяет экземпляр загруженной программы eBPF.

loadAmbient_redirectФункция используется для загрузки программы eBPF и сопоставления ее с ядром для реализации функции перенаправления среды.

loadAmbient_redirectObjectsФункции используются для загрузки объектов eBPF в ядро, включая программы и сопоставления.

CloseФункции используются для закрытия объектов и сопоставлений eBPF и высвобождения ресурсов.

_Ambient_redirectCloseФункция используется для отключения функции перенаправления среды.

logCNCFUnusedФункция используется для записи неиспользуемых объектов CNCF (Cloud Native Computing Foundation).

В целом,istio/cni/pkg/ebpf/server/ambient_redirect_bpf.goэти структуры и функции в файле используются для реализации серверного кода eBPF, загрузки программ eBPF и сопоставления с ядром, а также для обработки функций перенаправления среды.
