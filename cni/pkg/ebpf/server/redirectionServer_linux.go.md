# File: istio/cni/pkg/ebpf/server/redirectionServer_linux.go

В проекте`redirectionServer_linux.go` файл представляет собой серверный код, используемый для реализации функции перенаправления eBPF.Он отвечает за прослушивание запросов от других компонентов и выполнение соответствующих действий по перенаправлению трафика.

Ниже приводится подробное введение в некоторые переменные и структуры：

переменная：

1. `log`：Используется для записи информации журнала.
2. `isBigEndian`：Указывает, использует ли текущая система порядок байтов в конце строки.
3. `stringToLevel`：Сопоставьте строку уровня журнала с соответствующим типом перечисления, который используется для установки уровня журнала.


Структура：

1. `RedirectServer`： Представляет сервер перенаправления eBPF, который содержит метод, используемый для обработки запроса, и необходимую информацию о состоянии.
2. `eBPFObjects`：Определяет интерфейс объекта eBPF, включая методы для загрузки и выгрузки программ eBPF.
3. `eBPFObjectsImplOld`：`eBPFObjects` Старая реализация интерфейса, используемая в более старых версиях ядра Linux.
4. `eBPFObjectsImplNew`：`eBPFObjects` Новая реализация интерфейса для более новых версий ядра Linux.
5. `mapInfo`：Представляет таблицу карты в eBPF, которая содержит такую информацию, как тип и название таблицы.

Ниже приводится подробное введение в некоторые функции：

Close: Закройте объект eBPF и очистите ресурсы.
EBPFTProxySupport: Проверьте, поддерживает ли текущая система eBPF TProxy.
SetLogLevel: Установите уровень журнала.
UpdateHostIP: Обновите информацию об IP-адресе хоста.
AddPodToMesh: Добавьте определенный модуль в сетку и создайте соответствующую конфигурацию eBPF.
initBpfObjects: Инициализируйте объект eBPF.
NewRedirectServer: Создайте новый экземпляр сервера перенаправления eBPF.
checkOrMountBPFFSDefault: Проверьте или смонтируйте файловую систему BPFFS по умолчанию.
setLimit: Установите предел RLIMIT_MEMLOCK.
Start: Запустите сервер перенаправления eBPF.
parseIPs: Разрешите IP-адрес и маску подсети.
RemovePod: Извлеките определенный модуль из сетки.
handleRequest: Обрабатывать запросы от других компонентов.
AcceptRequest: Примите запрос и выполните соответствующие действия.
attachTCForZtunnel: Прикрепите правила TC к трафику Ztunnel.
detachTCForZtunnel:Удалите правило TC для трафика Ztunnel.
detachTCForWorkload:Удалите правило TC для трафика рабочей нагрузки.
attachTCForWorkLoad: Прикрепите правила TC к трафику рабочей нагрузки.
attachTC: Прикрепите правила TC к указанному сетевому интерфейсу.
delClsactQdisc: Удалите правило очереди CLSACT в указанном сетевом интерфейсе.
dumpZtunnelInfo: Распечатать информацию о дорожном движении в туннеле.
DumpAppIPs: Выведите IP-адрес трафика приложения.
htons,htonl: Функция преобразования порядка байтов.
Эти функции используются для реализации различных функций сервера перенаправления eBPF, включая настройку программ eBPF, обработку запросов, присоединение и удаление правил TC и печать информации о трафике.
