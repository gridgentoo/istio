# File: istio/cni/pkg/ebpf/server/redirectionServer_linux.go

В проекте`redirectionServer_linux.go` файл представляет собой серверный код, используемый для реализации функции перенаправления eBPF.Он отвечает за прослушивание запросов от других компонентов и выполнение соответствующих действий по перенаправлению трафика.

Ниже приводится подробное введение в некоторые переменные и структуры：

Переменная：

1. `log`：Используется для записи информации журнала.
2. `isBigEndian`：Указывает, использует ли текущая система порядок байтов в конце строки.
3. `stringToLevel`：Сопоставьте строку уровня журнала с соответствующим типом перечисления, который используется для установки уровня журнала.

Структура：

1. `RedirectServer`： Представляет сервер перенаправления eBPF, который содержит метод, используемый для обработки запроса, и необходимую информацию о состоянии.
2. `eBPFObjects`：Определяет интерфейс объекта eBPF, включая методы для загрузки и выгрузки программ eBPF.
3. `eBPFObjectsImplOld`：`eBPFObjects` Старая реализация интерфейса, используемая в более старых версиях ядра Linux.
4. `eBPFObjectsImplNew`：`eBPFObjects` Новая реализация интерфейса для более новых версий ядра Linux.
5. `mapInfo`：Представляет таблицу карты в eBPF, которая содержит такую информацию, как тип и название таблицы.

Ниже приводится подробное введение в некоторые функции：

1. `Close`：Закройте объект eBPF и очистите ресурсы.
2. `EBPFTProxySupport`：Проверьте, поддерживает ли текущая система eBPF TProxy.
3. `SetLogLevel`：Установите уровень журнала.
4. `UpdateHostIP`：Обновите информацию об IP-адресе хоста.
5. `AddPodToMesh`：Добавьте определенный модуль в сетку и создайте соответствующую конфигурацию eBPF.
6. `initBpfObjects`：Инициализируйте объект eBPF.
7. `NewRedirectServer`：Создайте новый экземпляр сервера перенаправления eBPF.
8. `checkOrMountBPFFSDefault`： Проверьте или смонтируйте файловую систему BPFFS по умолчанию.
9. `setLimit`：Установите предел RLIMIT_MEMLOCK.
10. `Start`：Запустите сервер перенаправления eBPF.
11. `parseIPs`：Разрешите IP-адрес и маску подсети.
12. `RemovePod`：Извлеките определенный Pod из сетки.
13. `handleRequest`：Обрабатывать запросы от других компонентов.
14. `AcceptRequest`：Примите запрос и выполните соответствующие действия.
15. `attachTCForZtunnel`：Прикрепите правила TC к трафику Ztunnel.
16. `detachTCForZtunnel`：Удалите правило TC для трафика Ztunnel.
17. `detachTCForWorkload`：Удалите правило TC для трафика рабочей нагрузки.
18. `attachTCForWorkLoad`：Прикрепите правила TC к трафику рабочей нагрузки.
19. `attachTC`：Прикрепите правила TC к указанному сетевому интерфейсу.
20. `delClsactQdisc`：Удалите правило очереди CLSACT в указанном сетевом интерфейсе.
21. `dumpZtunnelInfo`：Распечатать информацию о дорожном движении в туннеле.
22. `DumpAppIPs`：Выведите IP-адрес трафика приложения.
23. `htons`、`htonl`：Функция преобразования порядка байтов.

Эти функции используются для реализации различных функций сервера перенаправления eBPF, включая настройку программ eBPF, обработку запросов, присоединение и удаление правил TC и печать информации о трафике.
